<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Carmen Brando">
    <link rel="icon" href="images/favicon.ico">
    <title>Web REDEN</title>
	<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="carto-style.css" rel="stylesheet">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">
  	<link rel="stylesheet" href="label-map/leaflet.label.css" />
  	<style type="text/css">
	.info {
		padding: 6px 8px;
		font: 14px/16px Arial, Helvetica, sans-serif;
		background: white;
		background: rgba(255, 255, 255, 0.8);
		box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
		border-radius: 5px;
	}
	
	.info h4 {
		margin: 0 0 5px;
		color: #777;
	}
	
	.legend-i {
		clear: both;
		width: 18px;
		height: 18px;
		float: left;
		margin-right: 8px;
		opacity: 0.7;
	}
	
	.legend-label {
		line-height: 18px;
	}
	
	</style>
	<style>
	/* Adjustments according to mapbox */
	.leaflet-control-zoomslider-knob { width:14px; height:6px; }
	.leaflet-container .leaflet-control-zoomslider-body {
	  -webkit-box-sizing:content-box;
	     -moz-box-sizing:content-box;
	          box-sizing:content-box;
	  }
	</style>
  </head>
  <body>
    
	<div class="container">
      
      <h2>REDEN</h2>
      <p>Tool for named entity disambiguation and linking to the Linked Data cloud, code source can be found on <a href="https://github.com/cvbrandoe/REDEN">Github</a>.</p>
      <br>
      
      <h4>XML-TEI input file</h4>
      <p>The file needs to be well-formed and to follow specifications as defined by <a href="http://obvil-dev.paris-sorbonne.fr/developpements/teibook/">Obvil's TEIBook schema</a> and sample file can be found <a href="http://obvil.paris-sorbonne.fr/corpus/critique/renan_nation.xml">here</a>.</p>
      <p>As REDEN only performs linking on detected mentions, the input must already contain XML tags for annotating places (placeName) as defined in the <a href="http://www.tei-c.org/release/doc/tei-p5-doc/fr/html/ND.html">TEI-XML standard</a>. REDEN links entities via URIs to the <a href="http://fr.dbpedia.org">French DBpedia</a>.</p>
      
      <form>
      	<div class="form-group">
	      <textarea class="form-control" rows="10"></textarea>
		</div>
      	<div class="form-group">
    		<label for="exampleInputFile">Or load file from your computer</label>
    		<input type="file" id="exampleInputFile">    		
  		</div>  		   
	      <button type="submit" class="btn btn-default">Visualise</button>
	  </form>
      <br>
      <h4>Map</h4>
      <p>The following map shows distribution of places mentioned in the input TEI-XML file, geocoding is possible via <a href="http://fr.dbpedia.org">French DBpedia</a>.</p>
      <div id="map" class="myMap"></div>
      <div id="legend"></div>
      
      <hr>
      <footer class="footer">
      <p>
        Authors: <a href="http://obvil.paris-sorbonne.fr/obvil/annuaire/carmen-brando">Carmen Brando</a> and <a href="https://sites.google.com/site/francescafrontini/">Francesca Frontini</a>.
      </p>      
      </footer>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="bootstrap/js/bootstrap.file-input.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script src="label-map/leaflet.label.js"></script>
    <script type="text/javascript" src="data/places-in-tei.js"></script>
    <script type="text/javascript" src="params.js"></script>
    <script type="text/javascript">
    
    //Map creation and configuration
    $('input[type=file]').bootstrapFileInput();
    var center = new L.LatLng(45.706179, 17.402344);
    var Hydda_Base = L.tileLayer('http://{s}.tile.openstreetmap.se/hydda/base/{z}/{x}/{y}.png', {
    	attribution: 'Tiles courtesy of <a href="http://openstreetmap.se/" target="_blank">OpenStreetMap Sweden</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    	maxZoom: 20
    });
   
    var baseLayers = {
    		"ESRI style" : Hydda_Base
    	};
    var overlays = {};
    var geojsonLayer;
  	var map = new L.Map('map', {zoomsliderControl: true,
        zoomControl: false, center: center, zoom: 4, maxZoom: 6, layers : [ Hydda_Base ] });
    L.control.layers(baseLayers, overlays, {position : 'bottomright'} ).addTo(map);
 	
  	//legend control
  	var info = L.control();      
      info.onAdd = function (map) {
        this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
        this.update(null); 
        return this._div;
      };
    // method that we will use to update the control based on feature properties passed
    info.update = function (props) {     	 
        var arts = "<ul>";
        var countSelectedArt = 0;
        arts += "</ul>";
        this._div.innerHTML = '<h4>Place mentions in texts</h4>' + (props ?
          '<b><a href="'+props.geoNamesUri+'" target="_blank"> '+ props.name + '<a href="'+props.dbpediaUri +'"> (w) </a></a></b> is mentionned ' + props.occurrences + ' times. <br /> Click on any symbol to return'
          : 'Double click on symbol<br /><br />');
        if (!props) {
          for (var i = 0; i < mapQuantClasses.length; i++) {
            this._div.innerHTML +=
              '<i class="legend-i" style="background:' + getColor(mapQuantClasses[i] + 1) + '"></i> <span class="legend-label">' +
              mapQuantClasses[i] + (mapQuantClasses[i + 1] ? '&ndash;' + mapQuantClasses[i + 1] + '</span><br>' : '+');
          }
        }
      };
     info.addTo(map);
      
     function style(feature) {
    	var countSelectedArt = 0;
    	return {
        	radius: (countSelectedArt/2)*3 + 5,
    	    fillColor: getColor(countSelectedArt),
    	    weight: 1,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.7
        };
     }
     function getColor(d) {
        return d > mapQuantClasses[5]  ? '#800026' :
               d > mapQuantClasses[4]  ? '#BD0026' :
               d > mapQuantClasses[3]   ? '#E31A1C' :
               d > mapQuantClasses[2]   ? '#FC4E2A' :
               d > mapQuantClasses[1]   ? '#FD8D3C' :
                          '#FEB24C';
     }
     
     //adding data and adding interactions     
     geojsonLayer = L.geoJson(geoData, {
         pointToLayer: function (feature, latlng) {
        	 var countSelectedArt = 0;
	        	var marker = L.circleMarker(latlng, style(feature));
	             marker.bindLabel(feature.properties.name);
	             marker.setRadius((countSelectedArt/2)*3 + 5);
	             marker.on('mouseover', function (e) {
	            	 marker.setStyle({
	                     fillColor: '#78A700',
	                     dashArray: '',
	                     fillOpacity: 0.7
	                   });
	             });
	             marker.on('mouseout', function (e) {
	            	 marker.setStyle(style(feature));
	             });
	             marker.on('dblclick', function (e) {
	            	 marker.setStyle({
	                     fillColor: '#78A700',
	                     dashArray: '',
	                     fillOpacity: 0.7
	                   });
	            	 info.update(feature.properties);
	             });            
	             marker.on('click', function (e) {
	            	 marker.setStyle(style(feature));
	            	 info.update();
	             });
	             return marker;
         },
         filter: function(feature, layer) {
        	 var zoomLev = map.getZoom();        	 
   	         return (feature.properties.level == zoomLev);
   	   	 }
     }).addTo(map);
     
    function updatePropSymbols() { 
    	geojsonLayer.eachLayer(function(marker) {
    		var props = marker.feature.properties;
    		var feature = marker.feature;
    		info.update(props);
    		info.update();
    		var countArt = props.occurrences;       	 	
    		//update marker size
    		var radius = (countArt/2)*3 + 5;
    		marker.setRadius(radius);
    		  marker.on('mouseover', function (e) {
             	 marker.setStyle({
                      fillColor: '#78A700',
                      dashArray: '',
                      fillOpacity: 0.7
                    });
              });
              marker.on('mouseout', function (e) {
             	 marker.setStyle(style(feature));
              });
              marker.on('dblclick', function (e) {
             	 marker.setStyle({
                      fillColor: '#78A700',
                      dashArray: '',
                      fillOpacity: 0.7
                    });
             	 info.update(feature.properties);
              });            
              marker.on('click', function (e) {
             	 marker.setStyle(style(feature));
             	 info.update();
              });
              
    	});
    }
    </script>    
  </body>
</html>